# ä»£ç ç¤ºä¾‹æ€»è§ˆ

## æ¦‚è¿°

æœ¬ç›®å½•åŒ…å«äº†Maxellabs Runtime v2çš„å®Œæ•´ä»£ç ç¤ºä¾‹ï¼Œå±•ç¤ºäº†RHIã€Mathã€Specificationä¸‰ä¸ªåº“çš„åä½œä½¿ç”¨ã€‚æ¯ä¸ªç¤ºä¾‹éƒ½æ˜¯å®Œæ•´å¯è¿è¡Œçš„ï¼ŒåŒ…å«è¯¦ç»†çš„æ³¨é‡Šå’Œæœ€ä½³å®è·µè¯´æ˜ã€‚

## ğŸ¨ å®Œæ•´æ¸²æŸ“åœºæ™¯

**æ–‡ä»¶**: `complete-rendering-scene.md`

**åŠŸèƒ½**: å±•ç¤ºå¦‚ä½•ä½¿ç”¨RHIåˆ›å»ºWebGLè®¾å¤‡å’Œèµ„æºï¼Œä½¿ç”¨Mathåº“è¿›è¡Œ3Då˜æ¢å’ŒçŸ©é˜µè¿ç®—ï¼Œå®ç°å®Œæ•´çš„æ¸²æŸ“ç®¡çº¿è®¾ç½®

**å…³é”®ç‰¹æ€§**:
- RHIè®¾å¤‡åˆå§‹åŒ–å’Œèµ„æºç®¡ç†
- Mathå¯¹è±¡æ± ä¼˜åŒ–
- ç›¸æœºæ§åˆ¶å’Œè§†å›¾å˜æ¢
- å¤šæ¨¡å¼æ¸²æŸ“ï¼ˆå…‰ç…§ã€çº¿æ¡†ã€æ·±åº¦å¯è§†åŒ–ï¼‰
- æ€§èƒ½ç›‘æ§å’Œé”™è¯¯å¤„ç†
- å®æ—¶ç”¨æˆ·äº¤äº’æ§åˆ¶

**æŠ€æœ¯è¦ç‚¹**:
- WebGPUè®¾å¤‡åˆ›å»ºå’Œé…ç½®
- é¡¶ç‚¹ç¼“å†²åŒºå’Œç´¢å¼•ç¼“å†²åŒºç®¡ç†
- æ¸²æŸ“ç®¡çº¿å’Œç»‘å®šç»„
- å˜æ¢çŸ©é˜µè®¡ç®—
- è§†å£å’Œæ¸²æŸ“é€šé“ç®¡ç†

## ğŸ¬ åŠ¨ç”»ç³»ç»Ÿ

**æ–‡ä»¶**: `animation-system.md`

**åŠŸèƒ½**: å®Œæ•´çš„å…³é”®å¸§åŠ¨ç”»ç³»ç»Ÿï¼ŒåŒ…æ‹¬å¤šå±‚åŠ¨ç”»æ··åˆã€ç¼“åŠ¨å‡½æ•°å’Œæ€§èƒ½ä¼˜åŒ–

**å…³é”®ç‰¹æ€§**:
- Specificationé©±åŠ¨çš„åŠ¨ç”»æ•°æ®ç»“æ„
- å¤šç§ç¼“åŠ¨å‡½æ•°ï¼ˆçº¿æ€§ã€äºŒæ¬¡ã€ä¸‰æ¬¡ã€å¼¹æ€§ã€åå¼¹ç­‰ï¼‰
- å…³é”®å¸§æ’å€¼å™¨ï¼ˆæ ‡é‡ã€Vector3ã€Quaternionï¼‰
- å¤šå±‚åŠ¨ç”»æ··åˆï¼ˆè¦†ç›–ã€åŠ æ€§ï¼‰
- åŠ¨ç”»çŠ¶æ€æœºç³»ç»Ÿ
- æ€§èƒ½ä¼˜åŒ–å’Œå¯¹è±¡æ± ä½¿ç”¨

**æŠ€æœ¯è¦ç‚¹**:
- SLERPå››å…ƒæ•°æ’å€¼
- çƒé¢çº¿æ€§æ’å€¼å®ç°
- æ—¶é—´ç®¡ç†å’ŒåŠ¨ç”»å¾ªç¯
- æƒé‡æ··åˆç³»ç»Ÿ
- å†…å­˜ä¼˜åŒ–ç­–ç•¥

## ğŸ“¦ èµ„äº§ç®¡ç†

**æ–‡ä»¶**: `asset-pipeline.md`

**åŠŸèƒ½**: å®Œæ•´çš„èµ„äº§åŠ è½½å’Œç®¡ç†æµç¨‹ï¼ŒåŒ…æ‹¬USDèµ„äº§è§£æã€RHIèµ„æºåˆ›å»ºã€å†…å­˜ä¼˜åŒ–å’Œå¼‚æ­¥åŠ è½½

**å…³é”®ç‰¹æ€§**:
- å¤šæ ¼å¼æ”¯æŒï¼ˆUSDã€GLTFã€OBJã€FBXç­‰ï¼‰
- å¼‚æ­¥åŠ è½½å’Œæµå¼åŠ è½½
- å†…å­˜ç®¡ç†å’ŒGPUèµ„æºä¼˜åŒ–
- USDèµ„äº§å®Œæ•´è§£æå™¨
- è·¨å¹³å°å…¼å®¹æ€§å¤„ç†
- é”™è¯¯å¤„ç†å’Œé™çº§æ–¹æ¡ˆ

**æŠ€æœ¯è¦ç‚¹**:
- USDæ ¼å¼è§£æï¼ˆASCIIå’ŒäºŒè¿›åˆ¶ï¼‰
- èµ„äº§ä¾èµ–ç®¡ç†
- GPUèµ„æºåˆ›å»ºå’Œç»‘å®š
- å†…å­˜é¢„ç®—ç®¡ç†
- é¢„åŠ è½½å’Œç¼“å­˜ç­–ç•¥

## âš¡ æ€§èƒ½ä¼˜åŒ–

**æ–‡ä»¶**: `performance-optimization.md`

**åŠŸèƒ½**: å…¨é¢çš„æ€§èƒ½ä¼˜åŒ–æŠ€æœ¯ï¼ŒåŒ…æ‹¬RHIå‘½ä»¤ä¼˜åŒ–ã€Mathå¯¹è±¡æ± æ·±åº¦ä½¿ç”¨ã€SIMDä¼˜åŒ–ã€æ¸²æŸ“æ€§èƒ½åˆ†æå’Œå†…å­˜æ³„æ¼æ£€æµ‹

**å…³é”®ç‰¹æ€§**:
- å®æ—¶æ€§èƒ½ç›‘æ§å’Œåˆ†æ
- RHIå‘½ä»¤æ‰¹å¤„ç†å’ŒçŠ¶æ€ä¼˜åŒ–
- Mathå¯¹è±¡æ± æ™ºèƒ½ç®¡ç†
- SIMDå‘é‡åŒ–è®¡ç®—ä¼˜åŒ–
- å†…å­˜æ³„æ¼è‡ªåŠ¨æ£€æµ‹
- æ€§èƒ½åŸºå‡†æµ‹è¯•å’Œå¯¹æ¯”

**æŠ€æœ¯è¦ç‚¹**:
- GPUå‘½ä»¤é˜Ÿåˆ—ä¼˜åŒ–
- å¯¹è±¡æ± åŠ¨æ€è°ƒæ•´
- SIMDæŒ‡ä»¤è‡ªåŠ¨æ£€æµ‹å’Œä½¿ç”¨
- å†…å­˜ä½¿ç”¨è¶‹åŠ¿åˆ†æ
- å¾ªç¯å¼•ç”¨æ£€æµ‹

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- **TypeScript**: >= 4.5
- **WebGPU**: æ”¯æŒWebGPUçš„æµè§ˆå™¨ï¼ˆChrome 113+ã€Edge 113+ï¼‰
- **Node.js**: >= 16.0ï¼ˆç”¨äºå¼€å‘ç¯å¢ƒï¼‰

### è¿è¡Œç¤ºä¾‹

1. **å…‹éš†é¡¹ç›®**
```bash
git clone https://github.com/maxellabs/runtime.git
cd runtime
```

2. **å®‰è£…ä¾èµ–**
```bash
npm install
```

3. **å¯åŠ¨å¼€å‘æœåŠ¡å™¨**
```bash
npm run dev
```

4. **åœ¨æµè§ˆå™¨ä¸­è®¿é—®ç¤ºä¾‹**
- å®Œæ•´æ¸²æŸ“åœºæ™¯: `http://localhost:3000/examples/rendering-scene`
- åŠ¨ç”»ç³»ç»Ÿ: `http://localhost:3000/examples/animation`
- èµ„äº§ç®¡ç†: `http://localhost:3000/examples/assets`
- æ€§èƒ½ä¼˜åŒ–: `http://localhost:3000/examples/performance`

### è¿è¡Œå•ä¸ªç¤ºä¾‹

æ¯ä¸ªç¤ºä¾‹éƒ½å¯ä»¥ç‹¬ç«‹è¿è¡Œï¼š

```typescript
// å®Œæ•´æ¸²æŸ“åœºæ™¯ç¤ºä¾‹
import { CompleteRenderingScene } from './complete-rendering-scene';

const scene = new CompleteRenderingScene('canvas');
await scene.start();
```

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### åŸºå‡†æµ‹è¯•ç»“æœ

| ä¼˜åŒ–æŠ€æœ¯ | æ€§èƒ½æå‡ | é€‚ç”¨åœºæ™¯ |
|---------|---------|----------|
| SIMDå‘é‡è¿ç®— | 2-4x | å¤§æ‰¹é‡æ•°å­¦è®¡ç®— |
| å¯¹è±¡æ±  | 3-8x | é¢‘ç¹å¯¹è±¡åˆ›å»º/é”€æ¯ |
| å‘½ä»¤æ‰¹å¤„ç† | 2-5x | å¤§é‡ç»˜åˆ¶è°ƒç”¨ |
| å®ä¾‹åŒ–æ¸²æŸ“ | 10-50x | ç›¸åŒå‡ ä½•ä½“å¤šæ¬¡æ¸²æŸ“ |
| å†…å­˜ä¼˜åŒ– | 20-50% | å†…å­˜æ•æ„Ÿåº”ç”¨ |

### å†…å­˜ä½¿ç”¨ä¼˜åŒ–

```typescript
// ä¼˜åŒ–å‰ - æ¯å¸§åˆ›å»ºæ–°å¯¹è±¡
for (let i = 0; i < 1000; i++) {
    const matrix = new MMath.Matrix4();
    // ä½¿ç”¨matrix...
}

// ä¼˜åŒ–å - ä½¿ç”¨å¯¹è±¡æ± 
const matrices = MathPool.getMatrix4Batch(1000);
// ä½¿ç”¨matrices...
MathPool.releaseMatrix4Batch(matrices);
```

## ğŸ¯ æœ€ä½³å®è·µ

### 1. èµ„æºç®¡ç†

```typescript
// âœ… æ­£ç¡®çš„èµ„æºç”Ÿå‘½å‘¨æœŸ
const resource = resourceManager.getResource(assetId);
try {
    // ä½¿ç”¨èµ„æº...
} finally {
    resourceManager.releaseResource(assetId);
}
```

### 2. æ€§èƒ½ç›‘æ§

```typescript
// âœ… æŒç»­æ€§èƒ½ç›‘æ§
analyzer.beginFrame();
// æ¸²æŸ“ä»£ç ...
analyzer.endFrame();

if (analyzer.getMetrics().frame.fps < 30) {
    // è§¦å‘é™è´¨é‡ç­–ç•¥
}
```

### 3. é”™è¯¯å¤„ç†

```typescript
// âœ… å¥å£®çš„é”™è¯¯å¤„ç†
try {
    await assetLoader.loadAsset(url);
} catch (error) {
    console.error('åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨èµ„äº§:', error);
    await assetLoader.loadAsset(fallbackUrl);
}
```

### 4. å†…å­˜ç®¡ç†

```typescript
// âœ… ä½¿ç”¨å¯¹è±¡æ± é¿å…GC
const vector = MathPool.vec3(x, y, z);
// ä½¿ç”¨vector...
MathPool.releaseVec3(vector);
```

## ğŸ”„ ä»Demoè¿ç§»

å¦‚æœä½ å·²ç»åœ¨ä½¿ç”¨ç°æœ‰çš„Demoï¼Œè¿™é‡Œæœ‰ä¸€äº›è¿ç§»å»ºè®®ï¼š

### ç®€å•æ¸²æŸ“è¿ç§»

```typescript
// æ—§çš„Demoæ–¹å¼
const device = new WebGLDevice(canvas);
const pipeline = device.createRenderPipeline({...});

// æ–°çš„ä¼˜åŒ–æ–¹å¼
const scene = new CompleteRenderingScene('canvas');
await scene.init(); // è‡ªåŠ¨å¤„ç†è®¾å¤‡åˆå§‹åŒ–
```

### æ•°å­¦è¿ç®—è¿ç§»

```typescript
// æ—§çš„æ–¹å¼
const vector = new MMath.Vector3();

// æ–°çš„ä¼˜åŒ–æ–¹å¼
const vector = MathPool.vec3();
MathPool.releaseVec3(vector);
```

### èµ„äº§åŠ è½½è¿ç§»

```typescript
// æ—§çš„æ–¹å¼
const geometry = loadGeometry(url);

// æ–°çš„æ–¹å¼
const asset = await assetManager.loadAsset(url);
const resource = resourceManager.createMeshResource(asset);
```

## ğŸ› å¸¸è§é—®é¢˜

### Q: SIMDä¸æ”¯æŒæ€ä¹ˆåŠï¼Ÿ

A: SIMDWrapperä¼šè‡ªåŠ¨æ£€æµ‹SIMDæ”¯æŒå¹¶ä¼˜é›…é™çº§åˆ°æ ‡å‡†å®ç°ã€‚

### Q: å¯¹è±¡æ± ä»€ä¹ˆæ—¶å€™åº”è¯¥ä½¿ç”¨ï¼Ÿ

A: å½“å¯¹è±¡åˆ›å»ºé¢‘ç‡è¶…è¿‡æ¯ç§’1000æ¬¡æ—¶ï¼Œå»ºè®®ä½¿ç”¨å¯¹è±¡æ± ã€‚

### Q: å¦‚ä½•è°ƒè¯•æ€§èƒ½é—®é¢˜ï¼Ÿ

A: ä½¿ç”¨PerformanceAnalyzerè·å–è¯¦ç»†çš„æ€§èƒ½æŠ¥å‘Šå’Œå»ºè®®ã€‚

### Q: å†…å­˜æ³„æ¼å¦‚ä½•æ£€æµ‹ï¼Ÿ

A: å¯ç”¨GlobalMemoryLeakDetectorï¼Œå®ƒä¼šè‡ªåŠ¨è¿½è¸ªå’Œåˆ†æå†…å­˜ä½¿ç”¨ã€‚

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [RHIè¯¦ç»†æ–‡æ¡£](../rhi/)
- [Mathåº“æ–‡æ¡£](../math/)
- [Specificationæ–‡æ¡£](../specification/)
- [æœ€ä½³å®è·µæŒ‡å—](../../guides/best-practices.md)
- [å¸¸è§é—®é¢˜è§£ç­”](../../guides/faq.md)

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›è¿™äº›ç¤ºä¾‹ã€‚åœ¨æäº¤ä»£ç æ—¶ï¼Œè¯·ç¡®ä¿ï¼š

1. ä»£ç ç¬¦åˆé¡¹ç›®çš„TypeScriptè§„èŒƒ
2. æ·»åŠ äº†é€‚å½“çš„æ³¨é‡Šå’Œæ–‡æ¡£
3. åŒ…å«å¿…è¦çš„é”™è¯¯å¤„ç†
4. é€šè¿‡äº†æ€§èƒ½åŸºå‡†æµ‹è¯•

## ğŸ“„ è®¸å¯è¯

è¿™äº›ç¤ºä¾‹éµå¾ªé¡¹ç›®çš„MITè®¸å¯è¯ã€‚