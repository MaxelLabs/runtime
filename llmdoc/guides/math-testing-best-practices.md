---
title: Math Testing Best Practices
description: è‡ªåŠ¨åŒ–LLM-Nativeæ ‡å‡†åŒ–æŒ‡å—æ–‡æ¡£
category: guides
subcategory: math
tags: ['guide', 'llm-native', 'math', 'math-developers', 'code-examples', 'step-by-step']
target_audience: math-developers
complexity: intermediate
estimated_time: f"20 åˆ†é’Ÿ"
last_updated: 2025-12-17
llm_native_compliance: true
version: 1.0.0
---


## ğŸ¯ Context & Goal

### Context
æœ¬æ–‡æ¡£å±äº**math**ç±»å‹çš„å¼€å‘æŒ‡å—ï¼Œé¢å‘**math-developers**ã€‚

### Goal
å¸®åŠ©å¼€å‘è€…å¿«é€Ÿç†è§£å’ŒæŒæ¡ç›¸å…³æ¦‚å¿µã€å·¥å…·å’Œæœ€ä½³å®è·µï¼Œæé«˜å¼€å‘æ•ˆç‡å’Œä»£ç è´¨é‡ã€‚

### Prerequisites
- åŸºç¡€çš„ç¼–ç¨‹çŸ¥è¯†
- äº†è§£é¡¹ç›®æ¶æ„å’ŒåŸºæœ¬æ¦‚å¿µ
- ç›¸å…³é¢†åŸŸçš„å¼€å‘ç»éªŒ

---

# æ•°å­¦åº“æµ‹è¯•æœ€ä½³å®è·µæŒ‡å—

## 1. ç›®æ ‡
ç¡®ä¿æ•°å­¦åº“æµ‹è¯•çš„å‡†ç¡®æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œæ­£ç¡®å¤„ç† Float32Array ç²¾åº¦é—®é¢˜ã€‚

## 2. æ­¥éª¤ï¼ˆåŸå­åŒ–ï¼‰

### 2.1 Float32Array ç²¾åº¦æµ‹è¯•
1. **ä½¿ç”¨ toBeCloseTo è€Œé toBe**ï¼š
   - *å‚è€ƒ*: æ‰€æœ‰æ•°å­¦æµ‹è¯•æ–‡ä»¶ (`packages/math/test/**/*.test.ts`)
   - *åŸå› *: Float32Array åªæœ‰çº¦7ä½åè¿›åˆ¶ç²¾åº¦ï¼Œéœ€è¦ä½¿ç”¨è¿‘ä¼¼æ¯”è¾ƒ
   - *ç¤ºä¾‹*: `expect(vector.x).toBeCloseTo(expected, 5)` - 5ä½å°æ•°ç²¾åº¦è¶³å¤Ÿ

### 2.2 å¸¸é‡ä¸å¯å˜æ€§æµ‹è¯•
1. **ç†è§£ Object.freeze é™åˆ¶**ï¼š
   - *å‚è€ƒ*: `packages/math/test/core/vector2.test.ts` (å¸¸é‡æµ‹è¯•)
   - *é™åˆ¶*: JavaScript çš„ Object.freeze æ— æ³•æ·±åº¦å†»ç»“ Float32Array å†…éƒ¨ç¼“å†²åŒº
   - *å®è·µ*: æ–‡æ¡£åŒ–æ­¤é™åˆ¶ï¼Œæµ‹è¯•è¯­ä¹‰ä¸å˜æ€§è€Œéä¸¥æ ¼ä¸å¯å˜æ€§

### 2.3 å¯¹è±¡æ± ç»Ÿè®¡æµ‹è¯•
1. **ä½¿ç”¨æ­£ç¡®çš„å±æ€§å**ï¼š
   - *å‚è€ƒ*: `PoolStats` æ¥å£å®šä¹‰
   - *å±æ€§*: `currentActive` è€Œé `activeObjects`
   - *æ–‡ä»¶*: æ‰€æœ‰åŒ…å« `getPoolStats()` æµ‹è¯•çš„æ–‡ä»¶

### 2.4 çŸ©é˜µè¿ç®—æµ‹è¯•
1. **ç†è§£åˆ—ä¸»åºå­˜å‚¨**ï¼š
   - *å‚è€ƒ*: `packages/math/src/core/matrix4.ts`
   - *çº¦å®š*: OpenGL/WebGL æ ‡å‡†çš„åˆ—ä¸»åºå­˜å‚¨
   - *æµ‹è¯•*: éªŒè¯ `toIMatrix4x4()` çš„ç´¢å¼•æ˜ å°„æ­£ç¡®æ€§

### 2.5 Gamma/Linear ç©ºé—´è½¬æ¢æµ‹è¯•
1. **ä½¿ç”¨æ­£ç¡®çš„ sRGB å…¬å¼**ï¼š
   - *å‚è€ƒ*: `packages/math/src/core/color.ts` (linearToGamma æ–¹æ³•)
   - *å…¬å¼*: `1.055 * Math.pow(value, 1.0/2.4) - 0.055` for value >= 0.0031308
   - *ç²¾åº¦*: ä½¿ç”¨ 2-3 ä½å°æ•°ç²¾åº¦æµ‹è¯•è½¬æ¢ç»“æœ

### 2.6 é›¶å‘é‡æ£€æµ‹æµ‹è¯•
1. **ä½¿ç”¨æ­£ç¡®çš„ epsilon å€¼**ï¼š
   - *å‚è€ƒ*: `NumberEpsilon` å¸¸é‡ (1e-10)
   - *å®è·µ*: æµ‹è¯•å€¼å¿…é¡»å°äºç­‰äº epsilon æ‰è¢«è®¤ä¸ºæ˜¯é›¶
   - *ç¤ºä¾‹*: ä½¿ç”¨ 1e-11 è€Œé 1e-8 æµ‹è¯• isZero() æ–¹æ³•

## 3. å¸¸è§é™·é˜±

### 3.1 ç²¾åº¦é™·é˜±
- **é—®é¢˜**: ç›´æ¥ä½¿ç”¨ `toBe()` æ¯”è¾ƒ Float32Array å€¼
- **è§£å†³**: å§‹ç»ˆä½¿ç”¨ `toBeCloseTo(value, 5)`

### 3.2 æ¥å£ä¸åŒ¹é…é™·é˜±
- **é—®é¢˜**: æµ‹è¯•æœŸæœ›ä¸å®é™…æ¥å£å±æ€§åä¸ç¬¦
- **è§£å†³**: æ£€æŸ¥å¹¶ä½¿ç”¨æ­£ç¡®çš„æ¥å£å®šä¹‰

### 3.3 ç®—æ³•ç†è§£é™·é˜±
- **é—®é¢˜**: å¯¹æ•°å­¦å…¬å¼æˆ–çº¦å®šç†è§£é”™è¯¯
- **è§£å†³**: å‚è€ƒæƒå¨å®ç°å’Œæ–‡æ¡£ï¼Œå¦‚ sRGB è§„èŒƒ

## 4. æµ‹è¯•æ¨¡æ¿

```typescript
describe('æ•°å­¦ç±»å‹æµ‹è¯•', () => {
  // Float32Array ç²¾åº¦æµ‹è¯•
  test('åº”è¯¥æ­£ç¡®å¤„ç†ç²¾åº¦', () => {
    const result = mathOperation();
    expect(result.x).toBeCloseTo(expected.x, 5);
    expect(result.y).toBeCloseTo(expected.y, 5);
  });

  // å¸¸é‡ä¸å¯å˜æ€§æµ‹è¯•
  test('å¸¸é‡åº”è¯¥æ˜¯è¯­ä¹‰ä¸å˜çš„', () => {
    // Object.freeze ä¸èƒ½æ·±åº¦å†»ç»“ Float32Array
    // è¿™æ˜¯ JavaScript çš„å·²çŸ¥é™åˆ¶
    const original = Vector2.ONE.x;
    expect(original).toBe(1);
  });

  // å¯¹è±¡æ± ç»Ÿè®¡æµ‹è¯•
  test('åº”è¯¥è¿”å›æ­£ç¡®çš„æ± ç»Ÿè®¡ä¿¡æ¯', () => {
    const stats = MathType.getPoolStats();
    expect(stats).toHaveProperty('currentActive');
    expect(stats).toHaveProperty('poolSize');
  });
});
```
## ğŸ”Œ Interface First

### æ ¸å¿ƒæ¥å£å®šä¹‰
#### é…ç½®æ¥å£
```typescript
interface Config {
  version: string;
  options: Record<string, any>;
}
```

#### æ‰§è¡Œæ¥å£
```typescript
function execute(config: Config): Promise<Result> {
  // å®ç°é€»è¾‘
}
```

### ä½¿ç”¨æµç¨‹
1. **åˆå§‹åŒ–**: æŒ‰ç…§è§„èŒƒåˆå§‹åŒ–ç›¸å…³ç»„ä»¶
2. **é…ç½®**: è®¾ç½®å¿…è¦çš„å‚æ•°å’Œé€‰é¡¹
3. **æ‰§è¡Œ**: è°ƒç”¨æ ¸å¿ƒæ¥å£æ‰§è¡ŒåŠŸèƒ½
4. **éªŒè¯**: æ£€æŸ¥ç»“æœå’ŒçŠ¶æ€

---

# æ•°å­¦åº“æµ‹è¯•æœ€ä½³å®è·µæŒ‡å—

## 1. ç›®æ ‡
ç¡®ä¿æ•°å­¦åº“æµ‹è¯•çš„å‡†ç¡®æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œæ­£ç¡®å¤„ç† Float32Array ç²¾åº¦é—®é¢˜ã€‚

## 2. æ­¥éª¤ï¼ˆåŸå­åŒ–ï¼‰

### 2.1 Float32Array ç²¾åº¦æµ‹è¯•
1. **ä½¿ç”¨ toBeCloseTo è€Œé toBe**ï¼š
   - *å‚è€ƒ*: æ‰€æœ‰æ•°å­¦æµ‹è¯•æ–‡ä»¶ (`packages/math/test/**/*.test.ts`)
   - *åŸå› *: Float32Array åªæœ‰çº¦7ä½åè¿›åˆ¶ç²¾åº¦ï¼Œéœ€è¦ä½¿ç”¨è¿‘ä¼¼æ¯”è¾ƒ
   - *ç¤ºä¾‹*: `expect(vector.x).toBeCloseTo(expected, 5)` - 5ä½å°æ•°ç²¾åº¦è¶³å¤Ÿ

### 2.2 å¸¸é‡ä¸å¯å˜æ€§æµ‹è¯•
1. **ç†è§£ Object.freeze é™åˆ¶**ï¼š
   - *å‚è€ƒ*: `packages/math/test/core/vector2.test.ts` (å¸¸é‡æµ‹è¯•)
   - *é™åˆ¶*: JavaScript çš„ Object.freeze æ— æ³•æ·±åº¦å†»ç»“ Float32Array å†…éƒ¨ç¼“å†²åŒº
   - *å®è·µ*: æ–‡æ¡£åŒ–æ­¤é™åˆ¶ï¼Œæµ‹è¯•è¯­ä¹‰ä¸å˜æ€§è€Œéä¸¥æ ¼ä¸å¯å˜æ€§

### 2.3 å¯¹è±¡æ± ç»Ÿè®¡æµ‹è¯•
1. **ä½¿ç”¨æ­£ç¡®çš„å±æ€§å**ï¼š
   - *å‚è€ƒ*: `PoolStats` æ¥å£å®šä¹‰
   - *å±æ€§*: `currentActive` è€Œé `activeObjects`
   - *æ–‡ä»¶*: æ‰€æœ‰åŒ…å« `getPoolStats()` æµ‹è¯•çš„æ–‡ä»¶

### 2.4 çŸ©é˜µè¿ç®—æµ‹è¯•
1. **ç†è§£åˆ—ä¸»åºå­˜å‚¨**ï¼š
   - *å‚è€ƒ*: `packages/math/src/core/matrix4.ts`
   - *çº¦å®š*: OpenGL/WebGL æ ‡å‡†çš„åˆ—ä¸»åºå­˜å‚¨
   - *æµ‹è¯•*: éªŒè¯ `toIMatrix4x4()` çš„ç´¢å¼•æ˜ å°„æ­£ç¡®æ€§

### 2.5 Gamma/Linear ç©ºé—´è½¬æ¢æµ‹è¯•
1. **ä½¿ç”¨æ­£ç¡®çš„ sRGB å…¬å¼**ï¼š
   - *å‚è€ƒ*: `packages/math/src/core/color.ts` (linearToGamma æ–¹æ³•)
   - *å…¬å¼*: `1.055 * Math.pow(value, 1.0/2.4) - 0.055` for value >= 0.0031308
   - *ç²¾åº¦*: ä½¿ç”¨ 2-3 ä½å°æ•°ç²¾åº¦æµ‹è¯•è½¬æ¢ç»“æœ

### 2.6 é›¶å‘é‡æ£€æµ‹æµ‹è¯•
1. **ä½¿ç”¨æ­£ç¡®çš„ epsilon å€¼**ï¼š
   - *å‚è€ƒ*: `NumberEpsilon` å¸¸é‡ (1e-10)
   - *å®è·µ*: æµ‹è¯•å€¼å¿…é¡»å°äºç­‰äº epsilon æ‰è¢«è®¤ä¸ºæ˜¯é›¶
   - *ç¤ºä¾‹*: ä½¿ç”¨ 1e-11 è€Œé 1e-8 æµ‹è¯• isZero() æ–¹æ³•

## 3. å¸¸è§é™·é˜±

### 3.1 ç²¾åº¦é™·é˜±
- **é—®é¢˜**: ç›´æ¥ä½¿ç”¨ `toBe()` æ¯”è¾ƒ Float32Array å€¼
- **è§£å†³**: å§‹ç»ˆä½¿ç”¨ `toBeCloseTo(value, 5)`

### 3.2 æ¥å£ä¸åŒ¹é…é™·é˜±
- **é—®é¢˜**: æµ‹è¯•æœŸæœ›ä¸å®é™…æ¥å£å±æ€§åä¸ç¬¦
- **è§£å†³**: æ£€æŸ¥å¹¶ä½¿ç”¨æ­£ç¡®çš„æ¥å£å®šä¹‰

### 3.3 ç®—æ³•ç†è§£é™·é˜±
- **é—®é¢˜**: å¯¹æ•°å­¦å…¬å¼æˆ–çº¦å®šç†è§£é”™è¯¯
- **è§£å†³**: å‚è€ƒæƒå¨å®ç°å’Œæ–‡æ¡£ï¼Œå¦‚ sRGB è§„èŒƒ

## 4. æµ‹è¯•æ¨¡æ¿

```typescript
describe('æ•°å­¦ç±»å‹æµ‹è¯•', () => {
  // Float32Array ç²¾åº¦æµ‹è¯•
  test('åº”è¯¥æ­£ç¡®å¤„ç†ç²¾åº¦', () => {
    const result = mathOperation();
    expect(result.x).toBeCloseTo(expected.x, 5);
    expect(result.y).toBeCloseTo(expected.y, 5);
  });

  // å¸¸é‡ä¸å¯å˜æ€§æµ‹è¯•
  test('å¸¸é‡åº”è¯¥æ˜¯è¯­ä¹‰ä¸å˜çš„', () => {
    // Object.freeze ä¸èƒ½æ·±åº¦å†»ç»“ Float32Array
    // è¿™æ˜¯ JavaScript çš„å·²çŸ¥é™åˆ¶
    const original = Vector2.ONE.x;
    expect(original).toBe(1);
  });

  // å¯¹è±¡æ± ç»Ÿè®¡æµ‹è¯•
  test('åº”è¯¥è¿”å›æ­£ç¡®çš„æ± ç»Ÿè®¡ä¿¡æ¯', () => {
    const stats = MathType.getPoolStats();
    expect(stats).toHaveProperty('currentActive');
    expect(stats).toHaveProperty('poolSize');
  });
});
```
## âš ï¸ ç¦æ­¢äº‹é¡¹

### å…³é”®çº¦æŸ
- ğŸš« **å¿½ç•¥é”™è¯¯å¤„ç†**: ç¡®ä¿æ‰€æœ‰å¼‚å¸¸æƒ…å†µéƒ½æœ‰å¯¹åº”çš„å¤„ç†é€»è¾‘
- ğŸš« **ç¼ºå°‘éªŒè¯**: éªŒè¯è¾“å…¥å‚æ•°å’Œè¿”å›å€¼çš„æœ‰æ•ˆæ€§
- ğŸš« **ä¸éµå¾ªçº¦å®š**: ä¿æŒä¸é¡¹ç›®æ•´ä½“æ¶æ„å’Œçº¦å®šçš„ä¸€è‡´æ€§

### å¸¸è§é”™è¯¯
- âŒ å¿½ç•¥é”™è¯¯å¤„ç†å’Œå¼‚å¸¸æƒ…å†µ
- âŒ ç¼ºå°‘å¿…è¦çš„æ€§èƒ½ä¼˜åŒ–
- âŒ ä¸éµå¾ªé¡¹ç›®çš„ç¼–ç è§„èŒƒ
- âŒ å¿½ç•¥æ–‡æ¡£æ›´æ–°å’Œç»´æŠ¤

### æœ€ä½³å®è·µæé†’
- âœ… å§‹ç»ˆè€ƒè™‘æ€§èƒ½å½±å“
- âœ… æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
- âœ… ä¿æŒä»£ç çš„å¯ç»´æŠ¤æ€§
- âœ… å®šæœŸæ›´æ–°æ–‡æ¡£

---

# æ•°å­¦åº“æµ‹è¯•æœ€ä½³å®è·µæŒ‡å—

## 1. ç›®æ ‡
ç¡®ä¿æ•°å­¦åº“æµ‹è¯•çš„å‡†ç¡®æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œæ­£ç¡®å¤„ç† Float32Array ç²¾åº¦é—®é¢˜ã€‚

## 2. æ­¥éª¤ï¼ˆåŸå­åŒ–ï¼‰

### 2.1 Float32Array ç²¾åº¦æµ‹è¯•
1. **ä½¿ç”¨ toBeCloseTo è€Œé toBe**ï¼š
   - *å‚è€ƒ*: æ‰€æœ‰æ•°å­¦æµ‹è¯•æ–‡ä»¶ (`packages/math/test/**/*.test.ts`)
   - *åŸå› *: Float32Array åªæœ‰çº¦7ä½åè¿›åˆ¶ç²¾åº¦ï¼Œéœ€è¦ä½¿ç”¨è¿‘ä¼¼æ¯”è¾ƒ
   - *ç¤ºä¾‹*: `expect(vector.x).toBeCloseTo(expected, 5)` - 5ä½å°æ•°ç²¾åº¦è¶³å¤Ÿ

### 2.2 å¸¸é‡ä¸å¯å˜æ€§æµ‹è¯•
1. **ç†è§£ Object.freeze é™åˆ¶**ï¼š
   - *å‚è€ƒ*: `packages/math/test/core/vector2.test.ts` (å¸¸é‡æµ‹è¯•)
   - *é™åˆ¶*: JavaScript çš„ Object.freeze æ— æ³•æ·±åº¦å†»ç»“ Float32Array å†…éƒ¨ç¼“å†²åŒº
   - *å®è·µ*: æ–‡æ¡£åŒ–æ­¤é™åˆ¶ï¼Œæµ‹è¯•è¯­ä¹‰ä¸å˜æ€§è€Œéä¸¥æ ¼ä¸å¯å˜æ€§

### 2.3 å¯¹è±¡æ± ç»Ÿè®¡æµ‹è¯•
1. **ä½¿ç”¨æ­£ç¡®çš„å±æ€§å**ï¼š
   - *å‚è€ƒ*: `PoolStats` æ¥å£å®šä¹‰
   - *å±æ€§*: `currentActive` è€Œé `activeObjects`
   - *æ–‡ä»¶*: æ‰€æœ‰åŒ…å« `getPoolStats()` æµ‹è¯•çš„æ–‡ä»¶

### 2.4 çŸ©é˜µè¿ç®—æµ‹è¯•
1. **ç†è§£åˆ—ä¸»åºå­˜å‚¨**ï¼š
   - *å‚è€ƒ*: `packages/math/src/core/matrix4.ts`
   - *çº¦å®š*: OpenGL/WebGL æ ‡å‡†çš„åˆ—ä¸»åºå­˜å‚¨
   - *æµ‹è¯•*: éªŒè¯ `toIMatrix4x4()` çš„ç´¢å¼•æ˜ å°„æ­£ç¡®æ€§

### 2.5 Gamma/Linear ç©ºé—´è½¬æ¢æµ‹è¯•
1. **ä½¿ç”¨æ­£ç¡®çš„ sRGB å…¬å¼**ï¼š
   - *å‚è€ƒ*: `packages/math/src/core/color.ts` (linearToGamma æ–¹æ³•)
   - *å…¬å¼*: `1.055 * Math.pow(value, 1.0/2.4) - 0.055` for value >= 0.0031308
   - *ç²¾åº¦*: ä½¿ç”¨ 2-3 ä½å°æ•°ç²¾åº¦æµ‹è¯•è½¬æ¢ç»“æœ

### 2.6 é›¶å‘é‡æ£€æµ‹æµ‹è¯•
1. **ä½¿ç”¨æ­£ç¡®çš„ epsilon å€¼**ï¼š
   - *å‚è€ƒ*: `NumberEpsilon` å¸¸é‡ (1e-10)
   - *å®è·µ*: æµ‹è¯•å€¼å¿…é¡»å°äºç­‰äº epsilon æ‰è¢«è®¤ä¸ºæ˜¯é›¶
   - *ç¤ºä¾‹*: ä½¿ç”¨ 1e-11 è€Œé 1e-8 æµ‹è¯• isZero() æ–¹æ³•

## 3. å¸¸è§é™·é˜±

### 3.1 ç²¾åº¦é™·é˜±
- **é—®é¢˜**: ç›´æ¥ä½¿ç”¨ `toBe()` æ¯”è¾ƒ Float32Array å€¼
- **è§£å†³**: å§‹ç»ˆä½¿ç”¨ `toBeCloseTo(value, 5)`

### 3.2 æ¥å£ä¸åŒ¹é…é™·é˜±
- **é—®é¢˜**: æµ‹è¯•æœŸæœ›ä¸å®é™…æ¥å£å±æ€§åä¸ç¬¦
- **è§£å†³**: æ£€æŸ¥å¹¶ä½¿ç”¨æ­£ç¡®çš„æ¥å£å®šä¹‰

### 3.3 ç®—æ³•ç†è§£é™·é˜±
- **é—®é¢˜**: å¯¹æ•°å­¦å…¬å¼æˆ–çº¦å®šç†è§£é”™è¯¯
- **è§£å†³**: å‚è€ƒæƒå¨å®ç°å’Œæ–‡æ¡£ï¼Œå¦‚ sRGB è§„èŒƒ

## 4. æµ‹è¯•æ¨¡æ¿

```typescript
describe('æ•°å­¦ç±»å‹æµ‹è¯•', () => {
  // Float32Array ç²¾åº¦æµ‹è¯•
  test('åº”è¯¥æ­£ç¡®å¤„ç†ç²¾åº¦', () => {
    const result = mathOperation();
    expect(result.x).toBeCloseTo(expected.x, 5);
    expect(result.y).toBeCloseTo(expected.y, 5);
  });

  // å¸¸é‡ä¸å¯å˜æ€§æµ‹è¯•
  test('å¸¸é‡åº”è¯¥æ˜¯è¯­ä¹‰ä¸å˜çš„', () => {
    // Object.freeze ä¸èƒ½æ·±åº¦å†»ç»“ Float32Array
    // è¿™æ˜¯ JavaScript çš„å·²çŸ¥é™åˆ¶
    const original = Vector2.ONE.x;
    expect(original).toBe(1);
  });

  // å¯¹è±¡æ± ç»Ÿè®¡æµ‹è¯•
  test('åº”è¯¥è¿”å›æ­£ç¡®çš„æ± ç»Ÿè®¡ä¿¡æ¯', () => {
    const stats = MathType.getPoolStats();
    expect(stats).toHaveProperty('currentActive');
    expect(stats).toHaveProperty('poolSize');
  });
});
```
## ğŸ“š Few-Shotç¤ºä¾‹

### é—®é¢˜-è§£å†³æ–¹æ¡ˆå¯¹
**é—®é¢˜**: APIè°ƒç”¨è¿”å›é”™è¯¯
**è§£å†³æ–¹æ¡ˆ**: å®ç°é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
```typescript
try {
  const result = await apiCall(params);
  return result;
} catch (error) {
  if (retryCount < 3) {
    await delay(1000);
    return apiCall(params, retryCount + 1);
  }
  throw error;
}
```

**é—®é¢˜**: é…ç½®æ–‡ä»¶æ ¼å¼é”™è¯¯
**è§£å†³æ–¹æ¡ˆ**: æ·»åŠ é…ç½®éªŒè¯å’Œé»˜è®¤å€¼
```typescript
const config = validateAndNormalize(userConfig, defaultConfig);
if (!config.isValid()) {
  throw new ConfigError('é…ç½®éªŒè¯å¤±è´¥');
}
```

### å­¦ä¹ è¦ç‚¹
- ç†è§£å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ
- æŒæ¡æœ€ä½³å®è·µå’Œé¿å…é™·é˜±
- åŸ¹å…»é—®é¢˜è§£å†³æ€ç»´

---

# æ•°å­¦åº“æµ‹è¯•æœ€ä½³å®è·µæŒ‡å—

## 1. ç›®æ ‡
ç¡®ä¿æ•°å­¦åº“æµ‹è¯•çš„å‡†ç¡®æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œæ­£ç¡®å¤„ç† Float32Array ç²¾åº¦é—®é¢˜ã€‚

## 2. æ­¥éª¤ï¼ˆåŸå­åŒ–ï¼‰

### 2.1 Float32Array ç²¾åº¦æµ‹è¯•
1. **ä½¿ç”¨ toBeCloseTo è€Œé toBe**ï¼š
   - *å‚è€ƒ*: æ‰€æœ‰æ•°å­¦æµ‹è¯•æ–‡ä»¶ (`packages/math/test/**/*.test.ts`)
   - *åŸå› *: Float32Array åªæœ‰çº¦7ä½åè¿›åˆ¶ç²¾åº¦ï¼Œéœ€è¦ä½¿ç”¨è¿‘ä¼¼æ¯”è¾ƒ
   - *ç¤ºä¾‹*: `expect(vector.x).toBeCloseTo(expected, 5)` - 5ä½å°æ•°ç²¾åº¦è¶³å¤Ÿ

### 2.2 å¸¸é‡ä¸å¯å˜æ€§æµ‹è¯•
1. **ç†è§£ Object.freeze é™åˆ¶**ï¼š
   - *å‚è€ƒ*: `packages/math/test/core/vector2.test.ts` (å¸¸é‡æµ‹è¯•)
   - *é™åˆ¶*: JavaScript çš„ Object.freeze æ— æ³•æ·±åº¦å†»ç»“ Float32Array å†…éƒ¨ç¼“å†²åŒº
   - *å®è·µ*: æ–‡æ¡£åŒ–æ­¤é™åˆ¶ï¼Œæµ‹è¯•è¯­ä¹‰ä¸å˜æ€§è€Œéä¸¥æ ¼ä¸å¯å˜æ€§

### 2.3 å¯¹è±¡æ± ç»Ÿè®¡æµ‹è¯•
1. **ä½¿ç”¨æ­£ç¡®çš„å±æ€§å**ï¼š
   - *å‚è€ƒ*: `PoolStats` æ¥å£å®šä¹‰
   - *å±æ€§*: `currentActive` è€Œé `activeObjects`
   - *æ–‡ä»¶*: æ‰€æœ‰åŒ…å« `getPoolStats()` æµ‹è¯•çš„æ–‡ä»¶

### 2.4 çŸ©é˜µè¿ç®—æµ‹è¯•
1. **ç†è§£åˆ—ä¸»åºå­˜å‚¨**ï¼š
   - *å‚è€ƒ*: `packages/math/src/core/matrix4.ts`
   - *çº¦å®š*: OpenGL/WebGL æ ‡å‡†çš„åˆ—ä¸»åºå­˜å‚¨
   - *æµ‹è¯•*: éªŒè¯ `toIMatrix4x4()` çš„ç´¢å¼•æ˜ å°„æ­£ç¡®æ€§

### 2.5 Gamma/Linear ç©ºé—´è½¬æ¢æµ‹è¯•
1. **ä½¿ç”¨æ­£ç¡®çš„ sRGB å…¬å¼**ï¼š
   - *å‚è€ƒ*: `packages/math/src/core/color.ts` (linearToGamma æ–¹æ³•)
   - *å…¬å¼*: `1.055 * Math.pow(value, 1.0/2.4) - 0.055` for value >= 0.0031308
   - *ç²¾åº¦*: ä½¿ç”¨ 2-3 ä½å°æ•°ç²¾åº¦æµ‹è¯•è½¬æ¢ç»“æœ

### 2.6 é›¶å‘é‡æ£€æµ‹æµ‹è¯•
1. **ä½¿ç”¨æ­£ç¡®çš„ epsilon å€¼**ï¼š
   - *å‚è€ƒ*: `NumberEpsilon` å¸¸é‡ (1e-10)
   - *å®è·µ*: æµ‹è¯•å€¼å¿…é¡»å°äºç­‰äº epsilon æ‰è¢«è®¤ä¸ºæ˜¯é›¶
   - *ç¤ºä¾‹*: ä½¿ç”¨ 1e-11 è€Œé 1e-8 æµ‹è¯• isZero() æ–¹æ³•

## 3. å¸¸è§é™·é˜±

### 3.1 ç²¾åº¦é™·é˜±
- **é—®é¢˜**: ç›´æ¥ä½¿ç”¨ `toBe()` æ¯”è¾ƒ Float32Array å€¼
- **è§£å†³**: å§‹ç»ˆä½¿ç”¨ `toBeCloseTo(value, 5)`

### 3.2 æ¥å£ä¸åŒ¹é…é™·é˜±
- **é—®é¢˜**: æµ‹è¯•æœŸæœ›ä¸å®é™…æ¥å£å±æ€§åä¸ç¬¦
- **è§£å†³**: æ£€æŸ¥å¹¶ä½¿ç”¨æ­£ç¡®çš„æ¥å£å®šä¹‰

### 3.3 ç®—æ³•ç†è§£é™·é˜±
- **é—®é¢˜**: å¯¹æ•°å­¦å…¬å¼æˆ–çº¦å®šç†è§£é”™è¯¯
- **è§£å†³**: å‚è€ƒæƒå¨å®ç°å’Œæ–‡æ¡£ï¼Œå¦‚ sRGB è§„èŒƒ

## 4. æµ‹è¯•æ¨¡æ¿

```typescript
describe('æ•°å­¦ç±»å‹æµ‹è¯•', () => {
  // Float32Array ç²¾åº¦æµ‹è¯•
  test('åº”è¯¥æ­£ç¡®å¤„ç†ç²¾åº¦', () => {
    const result = mathOperation();
    expect(result.x).toBeCloseTo(expected.x, 5);
    expect(result.y).toBeCloseTo(expected.y, 5);
  });

  // å¸¸é‡ä¸å¯å˜æ€§æµ‹è¯•
  test('å¸¸é‡åº”è¯¥æ˜¯è¯­ä¹‰ä¸å˜çš„', () => {
    // Object.freeze ä¸èƒ½æ·±åº¦å†»ç»“ Float32Array
    // è¿™æ˜¯ JavaScript çš„å·²çŸ¥é™åˆ¶
    const original = Vector2.ONE.x;
    expect(original).toBe(1);
  });

  // å¯¹è±¡æ± ç»Ÿè®¡æµ‹è¯•
  test('åº”è¯¥è¿”å›æ­£ç¡®çš„æ± ç»Ÿè®¡ä¿¡æ¯', () => {
    const stats = MathType.getPoolStats();
    expect(stats).toHaveProperty('currentActive');
    expect(stats).toHaveProperty('poolSize');
  });
});
```