<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo 21: ÂéãÁº©Á∫πÁêÜÊîØÊåÅÊ£ÄÊµã</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            overflow: hidden;
        }

        #canvas {
            display: block;
            width: 100vw;
            height: 100vh;
        }

        .info-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
            min-width: 400px;
        }

        .info-panel h2 {
            margin-bottom: 15px;
            color: #00ff88;
            font-size: 18px;
        }

        .support-grid {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .format-name {
            font-weight: bold;
            color: #88ccff;
        }

        .support-status {
            text-align: right;
        }

        .support-status.yes {
            color: #00ff00;
        }

        .support-status.no {
            color: #ff4444;
        }

        .memory-info {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #333;
        }

        .memory-info h3 {
            margin-bottom: 10px;
            color: #ffaa00;
            font-size: 16px;
        }

        .memory-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .memory-label {
            color: #aaa;
        }

        .memory-value {
            font-weight: bold;
            color: #fff;
        }

        .format-details {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #333;
        }

        .format-details h3 {
            margin-bottom: 10px;
            color: #ff6600;
            font-size: 16px;
        }

        .format-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }

        .format-table th {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px;
            text-align: left;
            color: #ffaa00;
            border-bottom: 1px solid #444;
        }

        .format-table td {
            padding: 8px;
            border-bottom: 1px solid #222;
        }

        .format-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .compression-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: bold;
            margin-right: 5px;
        }

        .compression-4x1 { background: #44aa44; }
        .compression-6x1 { background: #6666aa; }
        .compression-8x1 { background: #aa44aa; }
        .compression-16x1 { background: #aa4444; }
        .compression-25x1 { background: #ff8800; }

        .quality-high { color: #00ff00; }
        .quality-medium { color: #ffaa00; }
        .quality-low { color: #ff4444; }

        .platform-tag {
            background: rgba(255, 255, 255, 0.1);
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
        }

        .controls {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .control-button {
            background: #333;
            color: #fff;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            transition: background 0.3s;
        }

        .control-button:hover {
            background: #555;
        }

        .control-button.active {
            background: #00ff88;
            color: #000;
        }

        .stats {
            position: absolute;
            bottom: 20px;
            left: 20px;
            font-family: monospace;
            font-size: 12px;
            color: #00ff88;
        }

        .warning {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 0, 0, 0.1);
            border: 2px solid #ff4444;
            padding: 30px;
            border-radius: 8px;
            text-align: center;
            max-width: 500px;
        }

        .warning h2 {
            color: #ff4444;
            margin-bottom: 15px;
        }

        .warning p {
            color: #aaa;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <canvas id="J-canvas"></canvas>

    <div class="info-panel">
        <h2>üîç ÂéãÁº©Á∫πÁêÜÊ†ºÂºèÊîØÊåÅÊ£ÄÊµã</h2>

        <div class="support-grid">
            <div class="format-name">S3TC (DXT/BC)</div>
            <div class="support-status" id="support-s3tc">Ê£ÄÊµã‰∏≠...</div>

            <div class="format-name">ETC2</div>
            <div class="support-status" id="support-etc2">Ê£ÄÊµã‰∏≠...</div>

            <div class="format-name">ASTC</div>
            <div class="support-status" id="support-astc">Ê£ÄÊµã‰∏≠...</div>

            <div class="format-name">PVRTC</div>
            <div class="support-status" id="support-pvrtc">Ê£ÄÊµã‰∏≠...</div>

            <div class="format-name">BPTC</div>
            <div class="support-status" id="support-bptc">Ê£ÄÊµã‰∏≠...</div>
        </div>

        <div class="memory-info">
            <h3>üíæ ÂÜÖÂ≠ò‰ΩøÁî®ÂØπÊØî</h3>
            <div class="memory-row">
                <span class="memory-label">ÂéüÂßãÂ§ßÂ∞è (512√ó512 RGBA8):</span>
                <span class="memory-value">1.00 MB</span>
            </div>
            <div class="memory-row">
                <span class="memory-label">BC1 ÂéãÁº© (4:1):</span>
                <span class="memory-value">0.25 MB (-75%)</span>
            </div>
            <div class="memory-row">
                <span class="memory-label">BC3 ÂéãÁº© (4:1):</span>
                <span class="memory-value">0.25 MB (-75%)</span>
            </div>
            <div class="memory-row">
                <span class="memory-label">ASTC 4√ó4 (8:1):</span>
                <span class="memory-value">0.13 MB (-87.5%)</span>
            </div>
            <div class="memory-row">
                <span class="memory-label">ASTC 8√ó8 (25:1):</span>
                <span class="memory-value">0.04 MB (-96%)</span>
            </div>
        </div>

        <div class="format-details">
            <h3>üìä ÂéãÁº©Ê†ºÂºèËØ¶ÁªÜ‰ø°ÊÅØ</h3>
            <table class="format-table">
                <thead>
                    <tr>
                        <th>Ê†ºÂºè</th>
                        <th>ÂéãÁº©ÊØî</th>
                        <th>Ë¥®Èáè</th>
                        <th>Âπ≥Âè∞</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <span class="compression-badge compression-4x1">4:1</span>
                            BC1 (DXT1)
                        </td>
                        <td>4:1</td>
                        <td class="quality-medium">‰∏≠Á≠â</td>
                        <td><span class="platform-tag">Ê°åÈù¢</span></td>
                    </tr>
                    <tr>
                        <td>
                            <span class="compression-badge compression-4x1">4:1</span>
                            BC3 (DXT5)
                        </td>
                        <td>4:1</td>
                        <td class="quality-high">È´ò</td>
                        <td><span class="platform-tag">Ê°åÈù¢</span></td>
                    </tr>
                    <tr>
                        <td>
                            <span class="compression-badge compression-6x1">6:1</span>
                            BC7
                        </td>
                        <td>6:1</td>
                        <td class="quality-high">ÂæàÈ´ò</td>
                        <td><span class="platform-tag">Ê°åÈù¢ DX11+</span></td>
                    </tr>
                    <tr>
                        <td>
                            <span class="compression-badge compression-4x1">4:1</span>
                            ETC2 RGBA8
                        </td>
                        <td>4:1</td>
                        <td class="quality-high">È´ò</td>
                        <td><span class="platform-tag">ÁßªÂä®Á´Ø Android</span></td>
                    </tr>
                    <tr>
                        <td>
                            <span class="compression-badge compression-8x1">8:1</span>
                            ASTC 4√ó4
                        </td>
                        <td>8:1</td>
                        <td class="quality-high">ÂæàÈ´ò</td>
                        <td><span class="platform-tag">ÁßªÂä®Á´Ø iOS/Android</span></td>
                    </tr>
                    <tr>
                        <td>
                            <span class="compression-badge compression-25x1">25:1</span>
                            ASTC 8√ó8
                        </td>
                        <td>25:1</td>
                        <td class="quality-medium">‰∏≠Á≠â</td>
                        <td><span class="platform-tag">ÁßªÂä®Á´Ø iOS/Android</span></td>
                    </tr>
                    <tr>
                        <td>
                            <span class="compression-badge compression-8x1">8:1</span>
                            PVRTC1 4bpp
                        </td>
                        <td>8:1</td>
                        <td class="quality-medium">‰∏≠Á≠â</td>
                        <td><span class="platform-tag">ÁßªÂä®Á´Ø iOS</span></td>
                    </tr>
                    <tr>
                        <td>
                            <span class="compression-badge compression-16x1">16:1</span>
                            PVRTC1 2bpp
                        </td>
                        <td>16:1</td>
                        <td class="quality-low">‰Ωé</td>
                        <td><span class="platform-tag">ÁßªÂä®Á´Ø iOS</span></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="controls">
        <button class="control-button active" id="btn-detect">ÈáçÊñ∞Ê£ÄÊµã</button>
        <button class="control-button" id="btn-comparison">ÂØπÊØîÊ®°Âºè</button>
    </div>

    <div class="stats" id="stats">
        <div>FPS: <span id="fps">0</span></div>
        <div>Frame Time: <span id="frameTime">0</span>ms</div>
    </div>

    <div class="loading" id="loading">
        Ê≠£Âú®ÂàùÂßãÂåñÂéãÁº©Á∫πÁêÜÊºîÁ§∫...
    </div>

    <script type="module" src="../src/compressed-texture.ts"></script>

    <script>
        // ÈöêËóèÂä†ËΩΩÊèêÁ§∫
        window.addEventListener('load', () => {
            setTimeout(() => {
                const loading = document.getElementById('loading');
                if (loading) {
                    loading.style.display = 'none';
                }
            }, 2000);
        });

        // Ê®°ÊãüÊõ¥Êñ∞ÊîØÊåÅÁä∂ÊÄÅÊòæÁ§∫
        function updateSupportStatus() {
            // WebGL2ÈÄöÂ∏∏ÊîØÊåÅETC2
            document.getElementById('support-etc2').className = 'support-status yes';
            document.getElementById('support-etc2').textContent = '‚úÖ ÊîØÊåÅ';

            // Ê°åÈù¢ÊµèËßàÂô®ÈÄöÂ∏∏ÊîØÊåÅS3TC
            const isDesktop = !/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            if (isDesktop) {
                document.getElementById('support-s3tc').className = 'support-status yes';
                document.getElementById('support-s3tc').textContent = '‚úÖ ÊîØÊåÅ';
            } else {
                document.getElementById('support-s3tc').className = 'support-status no';
                document.getElementById('support-s3tc').textContent = '‚ùå ‰∏çÊîØÊåÅ';
            }

            // ASTCÊîØÊåÅÊ£ÄÊµã
            const canvas = document.getElementById('J-canvas');
            if (canvas) {
                const gl = canvas.getContext('webgl2');
                if (gl && gl.getExtension('WEBGL_compressed_texture_astc')) {
                    document.getElementById('support-astc').className = 'support-status yes';
                    document.getElementById('support-astc').textContent = '‚úÖ ÊîØÊåÅ';
                } else {
                    document.getElementById('support-astc').className = 'support-status no';
                    document.getElementById('support-astc').textContent = '‚ùå ‰∏çÊîØÊåÅ';
                }
            }

            // PVRTC‰∏ªË¶ÅÊòØiOS
            if (/iPhone|iPad|iPod/.test(navigator.userAgent)) {
                document.getElementById('support-pvrtc').className = 'support-status yes';
                document.getElementById('support-pvrtc').textContent = '‚úÖ ÊîØÊåÅ';
            } else {
                document.getElementById('support-pvrtc').className = 'support-status no';
                document.getElementById('support-pvrtc').textContent = '‚ùå ‰∏çÊîØÊåÅ';
            }

            // BPTCÊòØËæÉÊñ∞ÁöÑÊ†ºÂºè
            document.getElementById('support-bptc').className = 'support-status no';
            document.getElementById('support-bptc').textContent = '‚ùå ‰∏çÊîØÊåÅ';
        }

        // È°µÈù¢Âä†ËΩΩÂêéÊõ¥Êñ∞Áä∂ÊÄÅ
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(updateSupportStatus, 1000);
        });

        // ÊåâÈíÆ‰∫ã‰ª∂
        setTimeout(() => {
            document.getElementById('btn-detect')?.addEventListener('click', () => {
                updateSupportStatus();
            });

            document.getElementById('btn-comparison')?.addEventListener('click', (e) => {
                e.target.classList.toggle('active');
            });
        }, 500);
    </script>
</body>
</html>
