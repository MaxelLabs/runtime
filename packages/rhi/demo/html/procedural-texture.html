<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç¨‹åºåŒ–çº¹ç†ç”Ÿæˆå™¨ - RHI Demo</title>
  <link rel="stylesheet" href="https://gw.alipayobjects.com/as/g/antui/antui/10.1.32/dpl/antui.css"/>
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #000;
    }

    .container {
      width: 100vw;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #J-canvas {
      display: block;
      cursor: grab;
    }

    #J-canvas:active {
      cursor: grabbing;
    }

    /* å·¦ä¸‹è§’ä»‹ç»é¢æ¿ */
    .info-panel {
      position: absolute;
      bottom: 20px;
      left: 20px;
      background: rgba(0, 0, 0, 0.85);
      color: white;
      padding: 15px 20px;
      border-radius: 8px;
      font-size: 13px;
      max-width: 380px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.15);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
    }

    .info-panel h3 {
      margin: 0 0 10px 0;
      color: #4CAF50;
      font-size: 16px;
    }

    .info-panel .description {
      color: #ddd;
      font-size: 12px;
      line-height: 1.5;
      margin-bottom: 10px;
    }

    .info-panel .tech-points {
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid rgba(255, 255, 255, 0.2);
    }

    .info-panel .tech-points h4 {
      margin: 0 0 5px 0;
      color: #2196F3;
      font-size: 13px;
    }

    .info-panel .tech-points ul {
      margin: 5px 0;
      padding-left: 20px;
      color: #aaa;
      font-size: 11px;
    }

    .info-panel .tech-points li {
      margin: 3px 0;
    }

    .error-message {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 0, 0, 0.9);
      color: white;
      padding: 20px;
      border-radius: 10px;
      font-family: monospace;
      z-index: 1000;
      max-width: 80%;
      text-align: center;
    }

    .loading {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 18px;
      z-index: 999;
    }

    /* çº¹ç†æ ‡ç­¾ */
    .texture-labels {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      grid-template-rows: 1fr 1fr;
      gap: 0;
      pointer-events: none;
      z-index: 10;
      opacity: 0;
      animation: fadeIn 1s ease-in-out 0.5s forwards;
    }

    .texture-label {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 10px;
      backdrop-filter: blur(5px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      text-align: center;
      margin: 20px;
    }

    /* çº¹ç†ç±»å‹æç¤º */
    .texture-hint {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 10px 20px;
      border-radius: 20px;
      font-size: 14px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      display: none;
    }

    /* ç»Ÿè®¡ä¿¡æ¯ */
    .stats {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 10px;
      border-radius: 5px;
      font-family: monospace;
      font-size: 12px;
      backdrop-filter: blur(5px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    @keyframes fadeIn {
      to {
        opacity: 1;
      }
    }

    /* ç½‘æ ¼çº¿ */
    .grid-overlay {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 90vmin;
      height: 60vmin;
      pointer-events: none;
      border: 1px dashed rgba(255, 255, 255, 0.1);
      display: none;
    }

    .grid-overlay::before,
    .grid-overlay::after {
      content: '';
      position: absolute;
      background: rgba(255, 255, 255, 0.1);
    }

    .grid-overlay::before {
      left: 33.33%;
      top: 0;
      width: 1px;
      height: 100%;
    }

    .grid-overlay::after {
      left: 66.66%;
      top: 0;
      width: 1px;
      height: 100%;
    }

    /* GUI æ ·å¼è¦†ç›– */
    .simple-gui {
      position: fixed !important;
      top: 20px !important;
      right: 20px !important;
      background: rgba(0, 0, 0, 0.85) !important;
      backdrop-filter: blur(10px) !important;
      border: 1px solid rgba(255, 255, 255, 0.15) !important;
    }

    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 768px) {
      .info-panel {
        max-width: 250px;
        font-size: 11px;
      }

      .info-panel h3 {
        font-size: 14px;
      }

      .texture-labels {
        grid-template-columns: 1fr 1fr;
        grid-template-rows: 1fr 1fr 1fr;
      }

      .texture-label {
        font-size: 9px;
        margin: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <canvas id="J-canvas"></canvas>
  </div>

  <!-- çº¹ç†æ ‡ç­¾ -->
  <div class="texture-labels" id="textureLabels">
    <div class="texture-label">Checkerboard</div>
    <div class="texture-label">Gradient</div>
    <div class="texture-label">Noise</div>
    <div class="texture-label">Solid Color</div>
    <div class="texture-label">UV Debug</div>
    <div class="texture-label">Normal Map</div>
  </div>

  <!-- å½“å‰æŸ¥çœ‹çº¹ç†æç¤º -->
  <div class="texture-hint" id="textureHint">
    Viewing: <span id="currentTextureName">All Textures</span>
  </div>

  <!-- ç½‘æ ¼çº¿ -->
  <div class="grid-overlay" id="gridOverlay">
    <div style="position: absolute; left: 0; top: 50%; width: 100%; height: 1px; background: rgba(255, 255, 255, 0.1);"></div>
  </div>

  <!-- å·¦ä¸‹è§’ä»‹ç»é¢æ¿ -->
  <div class="info-panel">
    <h3>ğŸ¨ ç¨‹åºåŒ–çº¹ç†ç”Ÿæˆå™¨</h3>
    <p class="description">
      å±•ç¤ºäº†6ç§ä¸åŒçš„ç¨‹åºåŒ–çº¹ç†ç”ŸæˆæŠ€æœ¯ã€‚å¯ä»¥åœ¨ç½‘æ ¼è§†å›¾ä¸­æŸ¥çœ‹æ‰€æœ‰çº¹ç†ï¼Œ
      æˆ–é€‰æ‹©ç‰¹å®šçº¹ç†è¿›è¡Œå‚æ•°è°ƒæ•´å’Œå®æ—¶é¢„è§ˆã€‚
    </p>

    <div class="tech-points">
      <h4>ğŸ’¡ æŠ€æœ¯è¦ç‚¹</h4>
      <ul>
        <li>ProceduralTexture ç±»ç”Ÿæˆå„ç§çº¹ç†</li>
        <li>å®æ—¶å‚æ•°è°ƒæ•´å’Œçº¹ç†æ›´æ–°</li>
        <li>å®ä¾‹åŒ–æ¸²æŸ“æ˜¾ç¤ºå¤šä¸ªçº¹ç†</li>
        <li>GPUçº¹ç†æ•°æ®åŠ¨æ€æ›´æ–°</li>
        <li>æ”¯æŒçº¹ç†å¯¼å‡ºåŠŸèƒ½</li>
      </ul>
    </div>

    <div class="tech-points">
      <h4>ğŸ® æ“ä½œè¯´æ˜</h4>
      <ul>
        <li>é¼ æ ‡æ‹–åŠ¨ï¼šæ—‹è½¬è§†è§’</li>
        <li>æ»šè½®ï¼šç¼©æ”¾è§†å›¾</li>
        <li>å³ä¾§é¢æ¿ï¼šè°ƒæ•´çº¹ç†å‚æ•°</li>
        <li>View Modeï¼šåˆ‡æ¢æŸ¥çœ‹æ¨¡å¼</li>
        <li>Export Selectedï¼šå¯¼å‡ºå½“å‰çº¹ç†</li>
      </ul>
    </div>
  </div>

  <div class="loading" id="loading">
    æ­£åœ¨åˆå§‹åŒ–ç¨‹åºåŒ–çº¹ç†ç”Ÿæˆå™¨...
  </div>

  <script type="module" src="../src/procedural-texture.ts"></script>

  <script>
    // éšè—åŠ è½½æç¤º
    window.addEventListener('load', () => {
      setTimeout(() => {
        const loading = document.getElementById('loading');
        if (loading) {
          loading.style.display = 'none';
        }
      }, 2000);
    });

    // ç›‘å¬çº¹ç†é€‰æ‹©å˜åŒ–
    let currentViewMode = 'All Textures';
    const updateTextureHint = (mode) => {
      currentViewMode = mode;
      const hint = document.getElementById('textureHint');
      const nameSpan = document.getElementById('currentTextureName');
      const labels = document.getElementById('textureLabels');
      const grid = document.getElementById('gridOverlay');

      if (mode === 'All Textures') {
        hint.style.display = 'none';
        labels.style.opacity = '1';
        grid.style.display = 'block';
      } else {
        hint.style.display = 'block';
        nameSpan.textContent = mode;
        labels.style.opacity = '0';
        grid.style.display = 'none';
      }
    };

    // æ·»åŠ äº¤äº’æç¤º
    let hintShown = false;
    document.addEventListener('click', () => {
      if (!hintShown) {
        console.log('ğŸ¨ ç¨‹åºåŒ–çº¹ç†ç”Ÿæˆå™¨ Demo å·²å¯åŠ¨ï¼');
        console.log('ğŸ“‹ æ”¯æŒçš„çº¹ç†ç±»å‹ï¼š');
        console.log('   1. Checkerboard - æ£‹ç›˜æ ¼å›¾æ¡ˆ');
        console.log('   2. Gradient - æ¸å˜è‰²');
        console.log('   3. Noise - å™ªå£°çº¹ç†');
        console.log('   4. Solid Color - çº¯è‰²');
        console.log('   5. UV Debug - UVåæ ‡è°ƒè¯•');
        console.log('   6. Normal Map - æ³•çº¿è´´å›¾');
        console.log('âš™ï¸  ä½¿ç”¨å³ä¾§GUIè°ƒæ•´å‚æ•°');
        console.log('ğŸ’¾ å¯ä»¥å¯¼å‡ºç”Ÿæˆçš„çº¹ç†å›¾ç‰‡');
        console.log('ğŸ–±ï¸ æ‹–åŠ¨é¼ æ ‡æ—‹è½¬è§†è§’æŸ¥çœ‹çº¹ç†');
        hintShown = true;
      }
    });

    // ç›‘å¬é”™è¯¯
    window.addEventListener('error', (event) => {
      console.error('Demo Error:', event.error);
      const errorMsg = document.createElement('div');
      errorMsg.className = 'error-message';
      errorMsg.textContent = `Error: ${event.error?.message || 'æœªçŸ¥é”™è¯¯'}`;
      document.body.appendChild(errorMsg);
      setTimeout(() => {
        errorMsg.remove();
      }, 5000);
    });

    // æ·»åŠ é”®ç›˜å¿«æ·é”®
    document.addEventListener('keydown', (e) => {
      // æ•°å­—é”®1-6åˆ‡æ¢çº¹ç†è§†å›¾
      if (e.key >= '1' && e.key <= '6') {
        const textureNames = [
          'Checkerboard',
          'Gradient',
          'Noise',
          'Solid Color',
          'UV Debug',
          'Normal Map'
        ];
        const index = parseInt(e.key) - 1;
        updateTextureHint(textureNames[index]);
      }
      // 0é”®æ˜¾ç¤ºæ‰€æœ‰çº¹ç†
      else if (e.key === '0') {
        updateTextureHint('All Textures');
      }
      // Eé”®å¯¼å‡ºå½“å‰çº¹ç†
      else if (e.key === 'e' || e.key === 'E') {
        console.log('å¯¼å‡ºå½“å‰çº¹ç†...');
      }
    });

    // æ€§èƒ½ç›‘æ§
    let frameCount = 0;
    let lastTime = performance.now();
    const updateStats = () => {
      frameCount++;
      const currentTime = performance.now();
      if (currentTime >= lastTime + 1000) {
        const fps = Math.round((frameCount * 1000) / (currentTime - lastTime));

        // åˆ›å»ºæˆ–æ›´æ–°FPSæ˜¾ç¤º
        let stats = document.querySelector('.stats');
        if (!stats) {
          stats = document.createElement('div');
          stats.className = 'stats';
          document.body.appendChild(stats);
        }
        stats.innerHTML = `FPS: ${fps}<br>Textures: 6`;

        frameCount = 0;
        lastTime = currentTime;
      }
      requestAnimationFrame(updateStats);
    };
    updateStats();
  </script>
</body>
</html>